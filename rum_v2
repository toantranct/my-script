!function(){"use strict";const e=document.currentScript,t=t=>e?.getAttribute(t),n={websiteId:t("data-website-id")||"",domain:t("data-domain")||"",apiBaseUrl:t("data-api-url")||window.location.origin,allowLocalhost:"true"===(t("data-allow-localhost")||"false"),allowFile:"true"===(t("data-allow-file-protocol")||"false"),allowIframe:"true"===(t("data-allow-iframe")||"false"),allowBots:"true"===(t("data-allow-bots")||"false"),debug:"true"===(t("data-debug")||"false"),maxBatch:parseInt(t("data-max-batch")||"50",10),rateLimitPerSec:parseInt(t("data-rate-limit-per-sec")||"100",10),trackVitals:"true"===(t("data-track-vitals")||"true"),trackConsole:"true"===(t("data-track-console")||"false")},i=new URL("/api/events",n.apiBaseUrl).href,o="[IndieW]",r=(...e)=>{if(n.debug)try{console.debug(o,...e)}catch{}},a=(...e)=>{try{console.error(o,...e)}catch{}},s={...console},c=window.fetch;function l(e){if(!e)return!1;const t=e.toLowerCase();return!!["localhost","127.0.0.1","::1"].includes(t)||(!!/^127(\.[0-9]+){0,3}$/.test(t)||(!!/^(\[)?::1?\]?$/.test(t)||!(!t.endsWith(".local")&&!t.endsWith(".localhost"))))}function d(e,t,i){let o="";if(i){const e=new Date;e.setTime(e.getTime()+24*i*60*60*1e3),o="; expires="+e.toUTCString()}let r=`${e}=${t||""}${o}; path=/; SameSite=Lax`;n.domain&&!l(window.location.hostname)&&"file:"!==window.location.protocol&&(r+="; domain=."+n.domain.replace(/^\./,"")),"https:"===window.location.protocol&&(r+="; Secure"),document.cookie=r}function u(e){const t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let i=n[e];for(;" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null}function w(e=""){return(e+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx").replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function f(){let e=u("indiew_visitor_id");return e||(e=w(""),d("indiew_visitor_id",e,365)),e}function h(){let e=u("indiew_session_id");return e||(e=w("s"),d("indiew_session_id",e,1/48)),e}function p(){try{d("indiew_session_id",h(),1/48)}catch{}}let g=!0,m="";!n.allowBots&&function(){if(n.allowBots)return!1;try{if(!0===window.navigator.webdriver)return!0;if(window.callPhantom||window._phantom||window.__nightmare)return!0;const e=((window.navigator||{}).userAgent||"").toLowerCase();if(!e||e.length<5)return!0;if(["headlesschrome","phantomjs","selenium","webdriver","puppeteer","playwright","python","curl","wget","java/","go-http","node.js","axios","postman"].some(t=>e.includes(t)))return!0;const t=["__webdriver_evaluate","__selenium_evaluate","__webdriver_script_function","__webdriver_unwrapped","__fxdriver_evaluate","__driver_evaluate","_Selenium_IDE_Recorder","_selenium","calledSelenium","$cdc_asdjflasutopfhvcZLmcfl_"];for(const e of t)if(void 0!==window[e])return!0;if(document.documentElement){if(document.documentElement.getAttribute("webdriver"))return!0;if(document.documentElement.getAttribute("selenium"))return!0;if(document.documentElement.getAttribute("driver"))return!0}}catch{return!1}return!1}()&&(g=!1,m="Bot detected"),!n.allowLocalhost&&l(window.location.hostname)&&(g=!1,m="Localhost blocked"),n.allowFile||"file:"!==window.location.protocol||(g=!1,m="file:// blocked"),n.allowIframe||window===window.parent||n.debug||(g=!1,m="Inside iframe"),n.websiteId&&n.domain||(g=!1,m="Missing website-id or domain");const v=[],_=[];let y=null,b=0,S=0;const k=new Set(["code","token","access_token","id_token","refresh_token","password","pass","pwd","session","auth","authorization","key","apikey","api_key","secret","client_secret"]);function x(){const e=Math.floor(Date.now()/1e3);return e!==b&&(b=e,S=0),!(S>=n.rateLimitPerSec)&&(S++,!0)}function I(e,t=1e3){if(null==e)return"";let n=String(e);return n.length>t&&(n=n.slice(0,t)),n=n.replace(/[<>'"&]/g,""),n=n.replace(/javascript:/gi,""),n=n.replace(/on\w+=/gi,""),n=n.replace(/data:/gi,""),n=n.replace(/vbscript:/gi,""),n.trim()}function E(e){if(!e)return e;return e.replace(/\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}\b/gi,"[redacted-email]").replace(/\b(bearer\s+[a-z0-9._-]{10,})\b/gi,"[redacted-token]").replace(/\beyJ[a-zA-Z0-9_-]{10,}\.[a-zA-Z0-9_-]{10,}\.[a-zA-Z0-9_-]{10,}\b/g,"[redacted-jwt]")}function L(e){try{const t=new URL(e,window.location.origin);return k.forEach(e=>t.searchParams.delete(e)),{full:t.toString(),host:t.host,path:t.pathname,query:t.search}}catch{return{full:String(e||""),host:"",path:"",query:""}}}function P(e){try{const t=new URL(e,window.location.origin).searchParams,n={};return["fbclid","gclid","gclsrc","wbraid","gbraid","li_fat_id","msclkid","ttclid","twclid","utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(e=>{const i=t.get(e);i&&(n[e]=i)}),Object.keys(n).length?n:void 0}catch{return}}function T(e,t,i,o=!1){if(!g)return;if(!x())return;const r=function(){const e=window.location.href||"",{full:t,host:i,path:o,query:r}=L(e);return{websiteId:n.websiteId,domain:n.domain,href:t,url_host:i,url_path:o,url_query:r,referrer:document.referrer||null,viewport:{width:window.innerWidth,height:window.innerHeight},lang:(navigator.language||"").toLowerCase(),userAgent:navigator.userAgent||"",visitorId:f(),sessionId:h(),adClick:P(t)}}(),a={type:e,ts:Date.now(),name:t?I(t,255):void 0,payload:i||{},context:{websiteId:r.websiteId,domain:r.domain,href:r.href,url_host:r.url_host,url_path:r.url_path,referrer:r.referrer,viewport:r.viewport,visitorId:r.visitorId,sessionId:r.sessionId,lang:r.lang,userAgent:r.userAgent,adClick:r.adClick}};o?_.push(a):v.push(a),v.length+_.length>=n.maxBatch&&A(),y||(y=setTimeout(A,5e3))}function C(e,t){try{if(navigator.sendBeacon){const n=navigator.sendBeacon(i,new Blob([e],{type:"application/json"}));return n&&p(),void t?.({status:n?200:0})}}catch{}try{return void c(i,{method:"POST",headers:{"Content-Type":"application/json"},body:e,keepalive:!0,credentials:"omit",cache:"no-store",mode:"cors"}).then(e=>{e&&e.ok&&p(),t?.({status:e.status})}).catch(()=>t?.({status:0}))}catch{}try{const n=new XMLHttpRequest;n.open("POST",i,!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(n.status>=200&&n.status<300&&p(),t?.({status:n.status}))},n.send(e)}catch{t?.({status:0})}}function A(e){const t=[..._,...v];if(!t.length)return;_.length=0,v.length=0,clearTimeout(y),y=null;const n=JSON.stringify({batch:t});if(n.length>204800){const n=Math.floor(t.length/2)||1,i=JSON.stringify({batch:t.slice(0,n)}),o=JSON.stringify({batch:t.slice(n)});return C(i),void C(o,e)}C(n,e)}function M(e){const t="indiew_last_pv";try{const n=Date.now(),i=window.location.href,o=JSON.parse(sessionStorage.getItem(t)||"null");if(o&&o.url===i&&n-o.time<6e4)return r("Pageview throttled"),void e?.({status:200});sessionStorage.setItem(t,JSON.stringify({time:n,url:i}))}catch{}T("pageview","pageview",{}),A(e)}function O(e,t){T("error","js_error",{message:I(E(e),500),stack:I(E(t||""),2e3)})}function N(e,t){T("identify","identify",{user_id:String(e),...t||{}})}function j(e,t){T("payment",e,{id:String(t)})}function B(e,t){const n={};let i=0;for(const[e,o]of Object.entries(t||{})){if(i>=10)break;/^[a-z0-9_-]{1,32}$/i.test(e)&&(n[e]=I(E(String(o)),255),i++)}T("custom",e,n)}["visibilitychange","pagehide","beforeunload"].forEach(e=>window.addEventListener(e,()=>A(),{passive:!0}));const q={lcp:null,cls:0,clsEntries:[],inp:null,fcp:null,ttfb:null,sent:new Set};function R(e,t){if(q.sent.has(e))return;const n=function(e,t){const[n,i]={LCP:[2500,4e3],CLS:[.1,.25],INP:[200,500],FCP:[1800,3e3],TTFB:[800,1800]}[e]||[0,0];return t<=n?"good":t<=i?"needs-improvement":"poor"}(e,t);!function(e,t,n){T("metric",e,{value:t,rating:n},!0)}(e,Math.round(t),n),q.sent.add(e),r(`${e}: ${Math.round(t)}ms (${n})`)}let $=null;function U(){if(n.trackVitals&&"PerformanceObserver"in window){try{const e=new PerformanceObserver(e=>{const t=e.getEntries(),n=t[t.length-1];q.lcp=n.renderTime||n.loadTime||n.startTime});e.observe({type:"largest-contentful-paint",buffered:!0});const t=()=>{q.lcp&&R("LCP",q.lcp),e.disconnect()};["visibilitychange","pagehide"].forEach(e=>window.addEventListener(e,t,{once:!0,passive:!0}))}catch(e){r("LCP observer failed:",e)}try{const e=new PerformanceObserver(e=>{for(const t of e.getEntries())t.hadRecentInput||(q.cls+=t.value,q.clsEntries.push(t));$&&clearTimeout($),$=setTimeout(()=>{R("CLS",q.cls)},500)});e.observe({type:"layout-shift",buffered:!0}),["pagehide","visibilitychange"].forEach(t=>window.addEventListener(t,()=>{$&&clearTimeout($),R("CLS",q.cls),e.disconnect()},{once:!0,passive:!0}))}catch(e){r("CLS observer failed:",e)}try{new PerformanceObserver(e=>{for(const t of e.getEntries()){const e=t.processingStart?t.processingEnd-t.processingStart:t.duration;(!q.inp||e>q.inp)&&(q.inp=e)}}).observe({type:"event",buffered:!0,durationThreshold:40});const e=()=>{q.inp&&R("INP",q.inp)};["visibilitychange","pagehide"].forEach(t=>window.addEventListener(t,e,{once:!0,passive:!0}))}catch(e){r("INP observer failed:",e)}try{const e=new PerformanceObserver(t=>{const n=t.getEntries().find(e=>"first-contentful-paint"===e.name);n&&(q.fcp=n.startTime,R("FCP",q.fcp),e.disconnect())});e.observe({type:"paint",buffered:!0})}catch(e){r("FCP observer failed:",e)}try{const e=performance.getEntriesByType("navigation")[0];e&&(q.ttfb=e.responseStart-e.requestStart,R("TTFB",q.ttfb))}catch(e){r("TTFB failed:",e)}}}if(window.addEventListener("error",e=>{if(g)try{O(e.message||"",e.error&&e.error.stack||"")}catch{}},{passive:!0}),window.addEventListener("unhandledrejection",e=>{if(g)try{const t=e.reason||{};O(t&&(t.message||t.toString())||"unhandledrejection",t&&t.stack)}catch{}},{passive:!0}),n.trackConsole){const e={log:.05,info:.1,warn:.5,error:1};["log","info","warn","error"].forEach(t=>{const i=s[t];console[t]=function(...o){try{Math.random()<(e[t]||0)&&function(e,t){if(!n.trackConsole)return;T("log",e,{level:e,message:I(E(t.map(e=>"string"==typeof e?e:JSON.stringify(e)).join(" ")),1e3)})}(t,o)}catch{}return i.apply(this,o)}})}new WeakMap;function F(e){if(e&&e.href)try{const t=new URL(e.href,window.location.origin);if("http:"!==t.protocol&&"https:"!==t.protocol)return;t.host!==window.location.host&&B("external_link",{url:t.toString(),text:(e.textContent||"").trim().slice(0,100)})}catch{}}function H(e){const t=e.getAttribute("data-indie-goal");if(!t)return;const n={eventName:t.trim()};for(const t of e.attributes)if(t.name.startsWith("data-indie-goal-")&&"data-indie-goal"!==t.name){n[t.name.substring(16).replace(/-/g,"_")]=t.value}B(n.eventName,n)}function W(){if(!("IntersectionObserver"in window))return void r("IntersectionObserver unsupported");const e=document.querySelectorAll("[data-indie-scroll]");if(!e.length)return;const t=new Map;e.forEach(e=>{const n=e.getAttribute("data-indie-scroll-threshold");let i=.5;if(null!==n){const e=parseFloat(n);!isNaN(e)&&e>=0&&e<=1&&(i=e)}t.has(i)||t.set(i,[]),t.get(i).push(e)}),t.forEach((e,t)=>{const n=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&function(e,t){const n=(e.getAttribute("data-indie-scroll")||"").trim();if(!n)return void t.unobserve(e);const i=parseInt(e.getAttribute("data-indie-scroll-delay")||"0",10),o=parseFloat(e.getAttribute("data-indie-scroll-threshold")||"0.5"),r=()=>{const r=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),a=window.innerHeight,s=window.pageYOffset||document.documentElement.scrollTop,c=r-a,l=c<=0?100:Math.min(100,Math.round(s/c*100)),d={eventName:n,scroll_percentage:String(l),threshold:String(o),delay:String(i)};for(const t of e.attributes)t.name.startsWith("data-indie-scroll-")&&"data-indie-scroll"!==t.name&&"data-indie-scroll-threshold"!==t.name&&"data-indie-scroll-delay"!==t.name&&(d[t.name.substring(18).replace(/-/g,"_")]=t.value);B(d.eventName,d),t.unobserve(e)};i>0?setTimeout(r,i):r()}(e.target,n)})},{root:null,rootMargin:"0px",threshold:t});e.forEach(e=>n.observe(e))})}window.fetch=async function(e,t){const n=performance.now();let o=0,r=!1,a="string"==typeof e?e:e?.url;try{const e=await c.apply(this,arguments);return o=e.status,r=e.ok,e}finally{const e=performance.now()-n;try{const t=new URL(String(a||""),window.location.origin).href;t!==i&&function(e,t,n,i){T("net","fetch",{url:L(e||"").full,status:t,ok:n,duration_ms:Math.round(i)})}(String(t),o,r,e)}catch{}}},document.addEventListener("click",e=>{const t=e.target.closest("[data-indie-goal]");t&&H(t);const n=e.target.closest("a");n&&F(n)},{passive:!0}),document.addEventListener("keydown",e=>{if("Enter"===e.key||" "===e.key){const t=e.target.closest("[data-indie-goal]");t&&H(t);const n=e.target.closest("a");n&&F(n)}},{passive:!0});let z=window.location.pathname,D=window.location.search,J=null;function Z(){J&&clearTimeout(J),J=setTimeout(()=>{Q()},100)}const V=window.history.pushState,X=window.history.replaceState;function Q(){M(),function(){try{const e=new URL(window.location.href),t=e.searchParams.get("session_id");t&&t.startsWith("cs_")&&!sessionStorage.getItem("iw_stripe_"+t)&&(j("stripe",t),sessionStorage.setItem("iw_stripe_"+t,"1"));const n=e.searchParams.get("checkout_id");n&&!sessionStorage.getItem("iw_polar_"+n)&&(j("polar",n),sessionStorage.setItem("iw_polar_"+n,"1"));const i=e.searchParams.get("order_id");i&&!sessionStorage.getItem("iw_lemon_"+i)&&(j("lemonsqueezy",i),sessionStorage.setItem("iw_lemon_"+i,"1"));const o=e.searchParams.get("paymentId")||e.searchParams.get("token");o&&!sessionStorage.getItem("iw_paypal_"+o)&&(j("paypal",o),sessionStorage.setItem("iw_paypal_"+o,"1"));const r=e.searchParams.get("_ptxn");r&&!sessionStorage.getItem("iw_paddle_"+r)&&(j("paddle",r),sessionStorage.setItem("iw_paddle_"+r,"1"))}catch{}}()}function Y(e,t,n){if(g){if(!e)return a("Missing action"),void n?.({status:400});switch(e){case"payment":if(!t?.provider||!t?.id)return void a("Missing provider/id");j(t.provider,t.id),A(n);break;case"identify":if(!t?.user_id)return void a("Missing user_id");N(t.user_id,t),A(n);break;case"custom":if(!t?.eventName)return void a("Missing eventName");const{eventName:i,...o}=t;B(i,o),A(n);break;case"pageview":M(n);break;case"error":if(!t?.message)return void a("Missing error message");O(t.message,t.stack),A(n);break;default:a("Unknown action:",e),n?.({status:400})}}else n?.({status:200})}window.history.pushState=function(){V.apply(this,arguments);const e=window.location.pathname,t=window.location.search;z===e&&D===t||(z=e,D=t,Z())},window.history.replaceState=function(){X.apply(this,arguments);const e=window.location.pathname,t=window.location.search;z===e&&D===t||(z=e,D=t,Z())},window.addEventListener("popstate",()=>{const e=window.location.pathname,t=window.location.search;z===e&&D===t||(z=e,D=t,Z())},{passive:!0}),g?"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{W(),U(),Q()}):(W(),U(),Q()):console.warn(`${o} disabled: ${m}`);let G=[];if(window.indiew&&Array.isArray(window.indiew.q)&&(G=window.indiew.q.map(e=>Array.from(e))),window.indiew=Y,G.length){G.forEach(e=>{try{Y.apply(null,e)}catch(e){a("Queue item error",e)}});try{delete window.indiew.q}catch{}}window.indiew.track=B,window.indiew.identify=(e,t)=>N(e,t),window.indiew.payment=(e,t)=>j(e,t),window.indiew.pageview=()=>M(),window.indiew.flush=e=>A(e),r("IndieW RUM initialized",{websiteId:n.websiteId,domain:n.domain,trackVitals:n.trackVitals,trackConsole:n.trackConsole})}();
